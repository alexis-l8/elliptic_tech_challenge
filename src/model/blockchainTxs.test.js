const { createModel } = require('./blockchainTxs')

describe('createModel()', () => {
  const blockTxs = [
    {
      transaction: {
        block_id: 590947,
        id: 446893035,
        hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
        date: '2019-08-20',
        time: '2019-08-20 10:56:54',
        size: 670,
        weight: 2680,
        version: 2,
        lock_time: 0,
        is_coinbase: false,
        has_witness: false,
        input_count: 2,
        output_count: 11,
        input_total: 256211122,
        input_total_usd: 27981.5,
        output_total: 256204322,
        output_total_usd: 27980.8,
        fee: 6800,
        fee_usd: 0.742646,
        fee_per_kb: 10149.3,
        fee_per_kb_usd: 1.10843,
        fee_per_kwu: 2537.31,
        fee_per_kwu_usd: 0.277107,
        cdd_total: 0.041951276467361
      },
      inputs: [
        {
          block_id: 590945,
          transaction_id: 446891733,
          index: 2,
          transaction_hash: 'bbea99a9e74fcbab79ed360360fc555a70dcca1ff40042100fb2990f8a8a47be',
          date: '2019-08-20',
          time: '2019-08-20 10:49:47',
          value: 20150600,
          value_usd: 2200.7,
          recipient: '17rznAA4HUaq6GzREz49eutTo9UK7SFBuj',
          type: 'pubkeyhash',
          script_hex: '76a9144b455e32d6ff1d230e34422f6a0565cf4f63b25488ac',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: true,
          spending_block_id: 590947,
          spending_transaction_id: 446893035,
          spending_index: 0,
          spending_transaction_hash:
            'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          spending_date: '2019-08-20',
          spending_time: '2019-08-20 10:56:54',
          spending_value_usd: 2200.7,
          spending_sequence: 4294967295,
          spending_signature_hex:
            '473044022039c5967c911ad7ce5f55d811fd7fa01e3143bbd704017806e457dddeca917aad0220659f3a3b6b01ef06ed051ba607a36926b107a1c69f73c7156683e0a07a8cd47001210230f023d9fd212b90da4d02d20fa36b0127fdaf38af7a2a243f454a548672f447',
          spending_witness: '',
          lifespan: 427,
          cdd: 0
        },
        {
          block_id: 590943,
          transaction_id: 446885033,
          index: 0,
          transaction_hash: '844f7a786ba7a6baa4e309a759fe43e212198a155023b025c6de1b53c888962f',
          date: '2019-08-20',
          time: '2019-08-20 10:31:55',
          value: 236060522,
          value_usd: 25780.8,
          recipient: '1vFZ8dDHjkVaYSuno68WQeCjjBhyKyD6E',
          type: 'pubkeyhash',
          script_hex: '76a9140a1231edc5776be856c21c0b686596aa0b05c95888ac',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: true,
          spending_block_id: 590947,
          spending_transaction_id: 446893035,
          spending_index: 1,
          spending_transaction_hash:
            'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          spending_date: '2019-08-20',
          spending_time: '2019-08-20 10:56:54',
          spending_value_usd: 25780.8,
          spending_sequence: 4294967295,
          spending_signature_hex:
            '47304402201425f80686b474417f2eac598614a8b4732011b6892cd95021afdbc3068c1c5502204b965a7e47be0567fed91bb105a29095818f2125cbf5b2d40af7953fad283d5f0121024a1d5f4060f3d1af234672252c2931b606cc5ad2488cd0d8c379f898aa96860b',
          spending_witness: '',
          lifespan: 1499,
          cdd: 0.0346990740740741
        }
      ],
      outputs: [
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 0,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 516087,
          value_usd: 56.3633,
          recipient: '145yo5yVgXycxMqG39roSpvukW942bTrGW',
          type: 'pubkeyhash',
          script_hex: '76a91421d97370056010445b8d8135e3a14dd0c117912488ac',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: true,
          spending_block_id: 590953,
          spending_transaction_id: 446905808,
          spending_index: 40,
          spending_transaction_hash:
            'af9ccbe7e79264acc49dbd62096ecb31bdec2ca08e4748be2aed087aebc0b191',
          spending_date: '2019-08-20',
          spending_time: '2019-08-20 11:45:15',
          spending_value_usd: 56.3633,
          spending_sequence: 4294967295,
          spending_signature_hex:
            '483045022100b1e07e31fc8b5ad1681ad5382f124fc764ad07952a448685837ea4795f2b0ded02203ae841399e86aa3741e964072a457819e5172e04607cfeba5625f1dd0da6667f01210296680687a739edaddde2635077fbfc132d07dd2390080c91b86144e5adbb60c6',
          spending_witness: '',
          lifespan: 2901,
          cdd: 0
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 1,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 6689000,
          value_usd: 730.524,
          recipient: '1GQPmSHNAzDWqEKxPaejLbDLBPBdEsSTYi',
          type: 'pubkeyhash',
          script_hex: '76a914a8f675457820715d20692f4e33477dada254747d88ac',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: true,
          spending_block_id: 590948,
          spending_transaction_id: 446896333,
          spending_index: 0,
          spending_transaction_hash:
            '9eb206e4113e5041353102921099942af94144753c605e5104f43e55dafabdec',
          spending_date: '2019-08-20',
          spending_time: '2019-08-20 11:01:05',
          spending_value_usd: 730.524,
          spending_sequence: 4294967295,
          spending_signature_hex:
            '47304402205e23788e39fade1254e680e71e815bf2e7b36f42ab120b3b742faf62a765d54d02203491da4f517a904aec5605f75546dff909c227192df121940a0afc8cb579f954012103d077bcd8a521e6a05b8873d7286c66bdb812a63cc8289314c047a611d3a1225b',
          spending_witness: '',
          lifespan: 251,
          cdd: 0
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 2,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 590000,
          value_usd: 64.4355,
          recipient: '3QroCwcJXVq3Uw1vShbmE2NGwdmHueW2Jm',
          type: 'scripthash',
          script_hex: 'a914fe246fd284cc09216e95d4245648999f6c9ea49187',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: true,
          spending_block_id: 590968,
          spending_transaction_id: 446941669,
          spending_index: 1,
          spending_transaction_hash:
            '84a32553f5ba65e5d3f146062d11198593a4ee71bd5737602511103e1f33baaf',
          spending_date: '2019-08-20',
          spending_time: '2019-08-20 14:24:53',
          spending_value_usd: 64.4355,
          spending_sequence: 4294967295,
          spending_signature_hex: '160014e7f89dc7fa0106db678854d39d08d0a68ba43793',
          spending_witness:
            '30440220461277c79658b6efd152d0f8b459059627cf6c2148f05de299086fd31740fdc3022041e7b9414fb85b5d31245c31516d8d67f19846dcb5f20d59aa6fbd7a08878a0c01,028f806c93504f1d076c856678d022220ccd540187b367eb7c6c467f607a8d5f89',
          lifespan: 12479,
          cdd: 0
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 3,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 609437,
          value_usd: 66.5583,
          recipient: '1KG6qWwd6Ewo3S4kqBAX7m99FeuLhLHFfi',
          type: 'pubkeyhash',
          script_hex: '76a914c84d602694ce5f301be0e3ae92c52846239ac9e988ac',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: true,
          spending_block_id: 590950,
          spending_transaction_id: 446899154,
          spending_index: 0,
          spending_transaction_hash:
            'ecd28191ff038187e0c2909a8d1c4c11644268120cf4c4de13ddf127f776df43',
          spending_date: '2019-08-20',
          spending_time: '2019-08-20 11:13:40',
          spending_value_usd: 66.5583,
          spending_sequence: 4294967295,
          spending_signature_hex:
            '4730440220177035c425f722f51989d951844d43e35672a73d1416e959e49530b96193049602202db4dbea2d7f86739aba4c09aee62c07edc7bf1ea2db498f57cc4e5b0c57247d012103d97315c0e6cc3ce9ff791c573c55d878629f0f5145b8836c2b2128b365c15fa3',
          spending_witness: '',
          lifespan: 1006,
          cdd: 0
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 4,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 1912845,
          value_usd: 208.907,
          recipient: '15VoGjLBGFTvgfWP4g4xZsUxo6j7SyKjmz',
          type: 'pubkeyhash',
          script_hex: '76a9143152c67b741294775d9f8444e6d5d6bcb9cbe61c88ac',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: false,
          spending_block_id: null,
          spending_transaction_id: null,
          spending_index: null,
          spending_transaction_hash: null,
          spending_date: null,
          spending_time: null,
          spending_value_usd: null,
          spending_sequence: null,
          spending_signature_hex: null,
          spending_witness: null,
          lifespan: null,
          cdd: null
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 5,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 323799,
          value_usd: 35.363,
          recipient: '14Hk9nwxWHDBbDXFGxZ2BU4X9Ra2v8dxJh',
          type: 'pubkeyhash',
          script_hex: '76a91424130dca9e942db7c347d8e9b1a152a6866ff97b88ac',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: true,
          spending_block_id: 590953,
          spending_transaction_id: 446905808,
          spending_index: 39,
          spending_transaction_hash:
            'af9ccbe7e79264acc49dbd62096ecb31bdec2ca08e4748be2aed087aebc0b191',
          spending_date: '2019-08-20',
          spending_time: '2019-08-20 11:45:15',
          spending_value_usd: 35.363,
          spending_sequence: 4294967295,
          spending_signature_hex:
            '47304402207a724eafd74ea94e4c20befae4050e522ea2482991ad2d34d615f584526e93b202203b99d9dc4679877b5b21ed43aee2eb23d81e472d4dc0a645f1c60987f4ce492f012103f022e6cc5e735945768a9e8a7797c53d6bf5ff75270db9f6734bc8897fefbd07',
          spending_witness: '',
          lifespan: 2901,
          cdd: 0
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 6,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 144475,
          value_usd: 15.7785,
          recipient: '3HvJhr2RP2A5ozi1Lj8Lva8VGF8MsHRVbz',
          type: 'scripthash',
          script_hex: 'a914b2056d9d25c1b3b15ebd9f2a28721f21908081cc87',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: false,
          spending_block_id: null,
          spending_transaction_id: null,
          spending_index: null,
          spending_transaction_hash: null,
          spending_date: null,
          spending_time: null,
          spending_value_usd: null,
          spending_sequence: null,
          spending_signature_hex: null,
          spending_witness: null,
          lifespan: null,
          cdd: null
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 7,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 225453192,
          value_usd: 24622.4,
          recipient: '1EPFNgnP2HuFeyHWM4BMjZ8SQd9N6VStKd',
          type: 'pubkeyhash',
          script_hex: '76a91492cec8fa751288829ef86eb6f3323c052d9e246d88ac',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: true,
          spending_block_id: 590948,
          spending_transaction_id: 446896145,
          spending_index: 0,
          spending_transaction_hash:
            '1b293d1863ab7dce461e1dcea7ecac50bdb13207081bf8471f618aa5b9bedbbb',
          spending_date: '2019-08-20',
          spending_time: '2019-08-20 11:01:05',
          spending_value_usd: 24622.4,
          spending_sequence: 4294967295,
          spending_signature_hex:
            '47304402205417f1d16396a10c082d1285c4738017eb31f3446cc63027cc349940204ed3450220647b6a3815f3bb46fd8a48ee7ad2cf6e0525323618eb5c291fcb8286bde98649012102787f6a0c186883427c645e1a3b7c0b2946627242205abd17a409554ccc14a1ff',
          spending_witness: '',
          lifespan: 251,
          cdd: 0.00581018518518519
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 8,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 10309536,
          value_usd: 1125.93,
          recipient: '14PfbKT6e7NuERxXc1qBbNoPyD1ds9bfq1',
          type: 'pubkeyhash',
          script_hex: '76a9142531be447a1c6e7852847d2b89c5660d6e32e64588ac',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: false,
          spending_block_id: null,
          spending_transaction_id: null,
          spending_index: null,
          spending_transaction_hash: null,
          spending_date: null,
          spending_time: null,
          spending_value_usd: null,
          spending_sequence: null,
          spending_signature_hex: null,
          spending_witness: null,
          lifespan: null,
          cdd: null
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 9,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 9638000,
          value_usd: 1052.59,
          recipient: '3Fx8nSX7fkhPZvL8Ccs5DTqGyo8RWjuvLH',
          type: 'scripthash',
          script_hex: 'a9149c6dba2239830638ebd07ee124f3d7afa79a46e587',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: true,
          spending_block_id: 590949,
          spending_transaction_id: 446897470,
          spending_index: 93,
          spending_transaction_hash:
            '033f72d64a83545b6ad91222ad648bfb3cecc43c3056640051d5ae29ae1ab0c3',
          spending_date: '2019-08-20',
          spending_time: '2019-08-20 11:09:55',
          spending_value_usd: 1052.59,
          spending_sequence: 4294967294,
          spending_signature_hex: '1600147da224300dd4459c9c3e6872816fc4673adb5dc3',
          spending_witness:
            '3045022100b3a971705eae00f8c0ac9a4f11150935c8baf8e51027b5c6ca6eb21d840cfabc02205be4cbaa8203f70ac3cf1006c2a22986533f981863eefff923cd3e740501ff5b01,0206e754fd266cdce679133c075a56b361a6b1d0ecc4a9a6383d47f7f6ebc5710d',
          lifespan: 781,
          cdd: 0
        },
        {
          block_id: 590947,
          transaction_id: 446893035,
          index: 10,
          transaction_hash: 'fd1b3909d384af10d76a06d4bb20c5cf96263472ef85be45164efe00db4ed2db',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 17951,
          value_usd: 1.96048,
          recipient: '3NiX3XoNkdCGxnnLUX8tKkfTWNxqati67D',
          type: 'scripthash',
          script_hex: 'a914e6a35db0af60bed50e7a19aac29729bbd85074a787',
          is_from_coinbase: false,
          is_spendable: null,
          is_spent: false,
          spending_block_id: null,
          spending_transaction_id: null,
          spending_index: null,
          spending_transaction_hash: null,
          spending_date: null,
          spending_time: null,
          spending_value_usd: null,
          spending_sequence: null,
          spending_signature_hex: null,
          spending_witness: null,
          lifespan: null,
          cdd: null
        }
      ]
    },
    {
      transaction: {
        block_id: 590947,
        id: 446893034,
        hash: 'eb6bb1cff1b967146ff6ed3d75a0596f18d22040686c7f7b3fb9b8e217e2250e',
        date: '2019-08-20',
        time: '2019-08-20 10:56:54',
        size: 261,
        weight: 936,
        version: 1,
        lock_time: 0,
        is_coinbase: true,
        has_witness: true,
        input_count: 1,
        output_count: 2,
        input_total: 0,
        input_total_usd: 0,
        output_total: 1273490544,
        output_total_usd: 139081,
        fee: 0,
        fee_usd: 0,
        fee_per_kb: 0,
        fee_per_kb_usd: 0,
        fee_per_kwu: 0,
        fee_per_kwu_usd: 0,
        cdd_total: 0
      },
      inputs: [],
      outputs: [
        {
          block_id: 590947,
          transaction_id: 446893034,
          index: 0,
          transaction_hash: 'eb6bb1cff1b967146ff6ed3d75a0596f18d22040686c7f7b3fb9b8e217e2250e',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 1273490544,
          value_usd: 139081,
          recipient: '18cBEMRxXHqzWWCxZNtU91F5sbUNKhL5PX',
          type: 'pubkeyhash',
          script_hex: '76a914536ffa992491508dca0354e52f32a3a7a679a53a88ac',
          is_from_coinbase: true,
          is_spendable: null,
          is_spent: false,
          spending_block_id: null,
          spending_transaction_id: null,
          spending_index: null,
          spending_transaction_hash: null,
          spending_date: null,
          spending_time: null,
          spending_value_usd: null,
          spending_sequence: null,
          spending_signature_hex: null,
          spending_witness: null,
          lifespan: null,
          cdd: null
        },
        {
          block_id: 590947,
          transaction_id: 446893034,
          index: 1,
          transaction_hash: 'eb6bb1cff1b967146ff6ed3d75a0596f18d22040686c7f7b3fb9b8e217e2250e',
          date: '2019-08-20',
          time: '2019-08-20 10:56:54',
          value: 0,
          value_usd: 0,
          recipient: 'd-8f3bdaa4176a3d096a6ea05828621bb8',
          type: 'nulldata',
          script_hex:
            '6a24aa21a9ed4485f0f4e46feb0bbd0d9d41a830a0325e7a74d14e2c60cf71bb64f4487e79de',
          is_from_coinbase: true,
          is_spendable: false,
          is_spent: false,
          spending_block_id: null,
          spending_transaction_id: null,
          spending_index: null,
          spending_transaction_hash: null,
          spending_date: null,
          spending_time: null,
          spending_value_usd: null,
          spending_sequence: null,
          spending_signature_hex: null,
          spending_witness: null,
          lifespan: null,
          cdd: null
        }
      ]
    }
  ]

  describe('#get', () => {
    it('returns store transaction data', () => {
      const blockchainTxs = createModel()
      blockchainTxs.set('bitcoin', 590947, blockTxs)

      const actual = blockchainTxs.get('bitcoin', 590947)
      const expected = blockTxs

      expect(actual).toEqual(expected)
    })
  })

  describe('#set', () => {
    it.only('does not store the same transaction twice', () => {
      const blockchainTxs = createModel()
      blockchainTxs.set('bitcoin', 590947, blockTxs)
      blockchainTxs.set('bitcoin', 590947, [blockTxs[0]])

      const actual = blockchainTxs.get('bitcoin', 590947)
      const expected = blockTxs

      expect(actual).toEqual(expected)
    })
  })
})
